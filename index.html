<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>ЧукотАВИА — доступные рейсы</title>

<style>
body { font-family: Arial; padding: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #eee; }
select, input, button { padding: 6px; margin-right: 6px; }
</style>
</head>

<body>

<h2>✈️ ЧукотАВИА — доступные рейсы</h2>

<select id="from"><option value="">Откуда</option></select>
<select id="to"><option value="">Куда</option></select>
<select id="aircraft"><option value="">Тип ВС</option></select>
<input type="date" id="date">
<button onclick="render()">Показать</button>

<table>
<thead>
<tr>
<th>Дата</th>
<th>Откуда</th>
<th>Куда</th>
<th>Рейс</th>
<th>Вылет</th>
<th>Прилёт</th>
<th>Самолёт</th>
<th>Цена</th>
<th>Мест</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
let flights = [];

fetch("chukotavia_api_results.csv")
  .then(r => r.text())
  .then(csv => {
    const lines = csv.trim().split("\n");
    const headers = lines.shift().split(",");

    flights = lines.map(l => {
      const v = l.split(",");
      let o = {};
      headers.forEach((h,i)=>o[h]=v[i]);
      return o;
    });

    fillFilters();
    render();
  })
  .catch(e => {
    alert("❌ Ошибка загрузки CSV");
    console.error(e);
  });

function fillFilters(){
  const fromSel = document.getElementById("from");
  const toSel = document.getElementById("to");
  const acSel = document.getElementById("aircraft");

  [...new Set(flights.map(f=>f.origin))].sort().forEach(v=>{
    fromSel.add(new Option(v,v));
  });

  [...new Set(flights.map(f=>f.destination))].sort().forEach(v=>{
    toSel.add(new Option(v,v));
  });

  [...new Set(flights.map(f=>f.aircraft))].sort().forEach(v=>{
    acSel.add(new Option(v,v));
  });
}

function render(){
  const from = document.getElementById("from").value;
  const to = document.getElementById("to").value;
  const ac = document.getElementById("aircraft").value;
  const date = document.getElementById("date").value;

  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  flights.filter(f =>
    (!from || f.origin === from) &&
    (!to || f.destination === to) &&
    (!ac || f.aircraft === ac) &&
    (!date || toISO(f.date) === date)
  ).forEach(f=>{
    tbody.innerHTML += `
      <tr>
        <td>${f.date}</td>
        <td>${f.origin}</td>
        <td>${f.destination}</td>
        <td>${f.flight_number}</td>
        <td>${f.departure}</td>
        <td>${f.arrival}</td>
        <td>${f.aircraft}</td>
        <td>${Number(f.price).toFixed(0)} ₽</td>
        <td>${f.available}</td>
      </tr>`;
  });
}

function toISO(d){
  const p=d.split(".");
  return `${p[2]}-${p[1]}-${p[0]}`;
}
</script>

</body>
</html>
