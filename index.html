<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>VintageAir — рейсы ЧукотАВИА</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #fafafa;
}

h2 {
  margin-bottom: 15px;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 15px;
}

select, input, button {
  padding: 8px;
  font-size: 14px;
}

button {
  cursor: pointer;
}

table {
  border-collapse: collapse;
  width: 100%;
  background: white;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

th {
  background: #eee;
}

.buy-btn {
  background: #007bff;
  color: white;
  text-decoration: none;
  padding: 4px 8px;
  border-radius: 4px;
  display: inline-block;
}

.buy-btn:hover {
  background: #0056b3;
}

.empty {
  margin-top: 10px;
  color: #666;
}
</style>
</head>

<body>

<h2>✈️ VintageAir — рейсы ЧукотАВИА</h2>

<div class="controls">
  <select id="from">
    <option value="">Откуда</option>
  </select>

  <select id="to">
    <option value="">Куда</option>
  </select>

  <select id="aircraft">
    <option value="">Тип ВС</option>
  </select>

  <input type="date" id="dateFrom">
  <input type="date" id="dateTo">

  <button onclick="render()">Показать</button>
  <button onclick="resetFilters()">Сброс</button>
</div>

<table>
<thead>
<tr>
  <th>Дата</th>
  <th>Откуда</th>
  <th>Куда</th>
  <th>Рейс</th>
  <th>Вылет</th>
  <th>Прилёт</th>
  <th>Самолёт</th>
  <th>Цена</th>
  <th>Мест</th>
  <th></th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div class="empty" id="empty"></div>

<script>
/* ==== CSV ДАННЫЕ ==== */
const RAW_CSV = `
date,origin,destination,flight_number,departure,arrival,aircraft,price,available
27.01.2026,DYR,БНГ,15,10:00,11:20,ANTONOV AN-24,19000.00,9
11.02.2026,DYR,БНГ,15,10:00,11:20,ANTONOV AN-24,19000.00,9
22.01.2026,DYR,ВГИ,49,09:30,11:30,DE HAVILLAND DHC-6 TWIN OTTER,7000.00,2
29.01.2026,DYR,ВГИ,3,10:00,12:00,DE HAVILLAND DHC-6 TWIN OTTER,7000.00,3
12.02.2026,DYR,ВГИ,3,10:00,12:00,DE HAVILLAND DHC-6 TWIN OTTER,7000.00,8
09.02.2026,DYR,KPW,25,10:00,12:20,ANTONOV AN-24,17000.00,9
03.02.2026,DYR,KVM,7,10:00,12:00,DE HAVILLAND DHC-6 TWIN OTTER,7000.00,2
10.02.2026,DYR,KVM,7,09:30,11:35,MI8/MI17/MI171/MI172,7000.00,7
20.01.2026,DYR,PVS,113,10:00,12:00,ANTONOV AN-24,15000.00,2
`;

/* ==== ПАРСИНГ CSV ==== */
const lines = RAW_CSV.trim().split("\n");
const headers = lines.shift().split(",");

const flights = lines.map(l => {
  const v = l.split(",");
  let o = {};
  headers.forEach((h,i)=>o[h]=v[i]);
  return o;
});

/* ==== ЗАПОЛНЕНИЕ ФИЛЬТРОВ ==== */
const fromSel = document.getElementById("from");
const toSel = document.getElementById("to");
const aircraftSel = document.getElementById("aircraft");

[...new Set(flights.map(f=>f.origin))].sort().forEach(v=>{
  fromSel.add(new Option(v,v));
});

[...new Set(flights.map(f=>f.destination))].sort().forEach(v=>{
  toSel.add(new Option(v,v));
});

[...new Set(flights.map(f=>f.aircraft))].sort().forEach(v=>{
  aircraftSel.add(new Option(v,v));
});

/* ==== УТИЛИТЫ ==== */
function toISO(d){
  const [dd,mm,yy] = d.split(".");
  return `${yy}-${mm}-${dd}`;
}

function resetFilters(){
  fromSel.value = "";
  toSel.value = "";
  aircraftSel.value = "";
  dateFrom.value = "";
  dateTo.value = "";
  render();
}

/* ==== РЕНДЕР ==== */
function render(){
  const tbody = document.getElementById("rows");
  const empty = document.getElementById("empty");
  tbody.innerHTML = "";
  empty.textContent = "";

  const fFrom = fromSel.value;
  const fTo = toSel.value;
  const fAircraft = aircraftSel.value;
  const dFrom = dateFrom.value;
  const dTo = dateTo.value;

  const res = flights.filter(f=>{
    if (fFrom && f.origin !== fFrom) return false;
    if (fTo && f.destination !== fTo) return false;
    if (fAircraft && f.aircraft !== fAircraft) return false;

    const iso = toISO(f.date);
    if (dFrom && iso < dFrom) return false;
    if (dTo && iso > dTo) return false;

    return true;
  });

  if (!res.length) {
    empty.textContent = "Рейсы не найдены";
    return;
  }

  res.forEach(f=>{
    tbody.innerHTML += `
    <tr>
      <td>${f.date}</td>
      <td>${f.origin}</td>
      <td>${f.destination}</td>
      <td>${f.flight_number}</td>
      <td>${f.departure}</td>
      <td>${f.arrival}</td>
      <td>${f.aircraft}</td>
      <td>${Number(f.price).toLocaleString("ru-RU")} ₽</td>
      <td>${f.available ?? "—"}</td>
      <td>
        <a class="buy-btn" href="https://booking.chukotavia.com/websky/" target="_blank">
          Купить
        </a>
      </td>
    </tr>`;
  });
}

/* ==== ПОКАЗ ПРИ ЗАГРУЗКЕ ==== */
render();
</script>

</body>
</html>
