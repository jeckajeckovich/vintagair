<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>VintageAir ‚Äî —Ä–µ–π—Å—ã –ß—É–∫–æ—Ç–ê–í–ò–ê</title>

<style>
body { font-family: Arial, sans-serif; padding: 20px; background:#f6f6f6 }
h2 { margin-bottom: 10px }

.filters {
  background:#fff;
  padding:15px;
  border-radius:8px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  box-shadow:0 2px 6px rgba(0,0,0,.1)
}

select, input {
  padding:7px;
  font-size:14px;
}

table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
  margin-top:20px;
}

th,td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}

th {
  background:#eee;
  cursor:pointer;
}

#empty {
  margin-top:25px;
  color:#666;
  text-align:center;
}
#routes {
  margin-top:30px;
  background:#fff;
  padding:15px;
  border-radius:8px;
}
</style>
</head>

<body>

<h2>‚úàÔ∏è VintageAir ‚Äî —Ä–µ–π—Å—ã –ß—É–∫–æ—Ç–ê–í–ò–ê</h2>

<div class="filters">
  <select id="from"><option value="">–û—Ç–∫—É–¥–∞</option></select>
  <select id="to"><option value="">–ö—É–¥–∞</option></select>
  <select id="aircraft"><option value="">–¢–∏–ø –í–°</option></select>

  <input type="date" id="dateFrom">
  <input type="date" id="dateTo">
</div>

<div id="empty">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</div>

<table id="table" style="display:none">
<thead>
<tr>
  <th data-sort="date">–î–∞—Ç–∞</th>
  <th>–û—Ç–∫—É–¥–∞</th>
  <th>–ö—É–¥–∞</th>
  <th>–†–µ–π—Å</th>
  <th>–í—ã–ª–µ—Ç</th>
  <th>–ü—Ä–∏–ª—ë—Ç</th>
  <th>–°–∞–º–æ–ª—ë—Ç</th>
  <th data-sort="price">–¶–µ–Ω–∞</th>
  <th data-sort="available">–ú–µ—Å—Ç</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div id="routes">
  <h3>üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç—ã</h3>
  <ul id="routesList"></ul>
</div>

<script>
let flights = [];
let sortKey = null;
let sortDir = 1;

/* ===== –ó–ê–ì–†–£–ó–ö–ê CSV ===== */
fetch("chukotavia_api_results.csv")
.then(r=>r.text())
.then(csv=>{
  const lines = csv.trim().split("\n");
  const headers = lines.shift().split(",");
  flights = lines.map(l=>{
    const v=l.split(",");
    let o={};
    headers.forEach((h,i)=>o[h]=v[i]);
    return o;
  });
  initFilters();
  render();
  renderRoutes();
});

/* ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï ===== */
const norm = d => {
  const p=d.split(".");
  return `${p[2]}-${p[1]}-${p[0]}`;
};

const uniq = arr => [...new Set(arr)].sort();

/* ===== –§–ò–õ–¨–¢–†–´ ===== */
function initFilters(){
  fill("from", flights.map(f=>f.origin));
  fill("to", flights.map(f=>f.destination));
  fill("aircraft", flights.map(f=>f.aircraft));

  document.querySelectorAll("select,input").forEach(e=>{
    e.addEventListener("change", render);
  });
}

function fill(id, values){
  const s=document.getElementById(id);
  uniq(values).forEach(v=>s.add(new Option(v,v)));
}

/* ===== –†–ï–ù–î–ï–† ===== */
function render(){
  let res = flights.filter(f =>
    (!from.value || f.origin===from.value) &&
    (!to.value || f.destination===to.value) &&
    (!aircraft.value || f.aircraft===aircraft.value) &&
    (!dateFrom.value || norm(f.date)>=dateFrom.value) &&
    (!dateTo.value || norm(f.date)<=dateTo.value)
  );

  if(sortKey){
    res.sort((a,b)=>{
      let x=a[sortKey], y=b[sortKey];
      if(sortKey!=="date") x=Number(x), y=Number(y);
      return (x>y?1:-1)*sortDir;
    });
  }

  rows.innerHTML="";
  if(!res.length){
    empty.style.display="block";
    table.style.display="none";
    return;
  }

  empty.style.display="none";
  table.style.display="table";

  res.forEach(f=>{
    rows.innerHTML+=`
    <tr>
      <td>${f.date}</td>
      <td>${f.origin}</td>
      <td>${f.destination}</td>
      <td>${f.flight_number}</td>
      <td>${f.departure}</td>
      <td>${f.arrival}</td>
      <td>${f.aircraft}</td>
      <td>${Number(f.price).toLocaleString()} ‚ÇΩ</td>
      <td>${f.available}</td>
    </tr>`;
  });
}

/* ===== –°–û–†–¢–ò–†–û–í–ö–ê ===== */
document.querySelectorAll("th[data-sort]").forEach(th=>{
  th.onclick=()=>{
    const k=th.dataset.sort;
    sortDir = (sortKey===k)?-sortDir:1;
    sortKey=k;
    render();
  };
});

/* ===== –ú–ê–†–®–†–£–¢–´ ===== */
function renderRoutes(){
  const set = new Set(flights.map(f=>`${f.origin} ‚Üí ${f.destination}`));
  routesList.innerHTML="";
  [...set].sort().forEach(r=>{
    routesList.innerHTML+=`<li>${r}</li>`;
  });
}

/* ===== –≠–õ–ï–ú–ï–ù–¢–´ ===== */
const from=document.getElementById("from");
const to=document.getElementById("to");
const aircraft=document.getElementById("aircraft");
const dateFrom=document.getElementById("dateFrom");
const dateTo=document.getElementById("dateTo");
const rows=document.getElementById("rows");
const table=document.getElementById("table");
const empty=document.getElementById("empty");
const routesList=document.getElementById("routesList");
</script>

</body>
</html>
