<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>VintageAir ‚Äî —Ä–µ–π—Å—ã –ß—É–∫–æ—Ç–ê–í–ò–ê</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.geodesic/Leaflet.Geodesic.min.js"></script>
<!-- PapaParse –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ —Ä–∞–∑–±–æ—Ä–∞ CSV -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  padding:20px;
  background:#f4f6f8;
}

header {
  display:flex;
  align-items:center;
  gap:15px;
  margin-bottom:20px;
}

header img { height:48px; }

/* ===== –í–ò–¢–†–ò–ù–ê ===== */
.aircraft-showcase {
  display:flex;
  gap:16px;
  margin-bottom:20px;
  overflow-x:auto;
}

.aircraft-card {
  min-width:160px;
  background:#fff;
  border-radius:14px;
  padding:16px;
  text-align:center;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  border:2px solid transparent;
  transition:.2s;
}

.aircraft-card:hover {
  transform:translateY(-4px);
}

.aircraft-card.active {
  border-color:#1e88e5;
  background:#e3f2fd;
}

.aircraft-icon {
  font-size:32px;
  margin-bottom:8px;
}

.filters {
  background:#fff;
  padding:15px;
  border-radius:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}

select,input,button {
  padding:7px;
  font-size:14px;
}

table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
  margin-top:20px;
}

th,td {
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}

th { background:#eee }

.buy {
  background:#1e88e5;
  color:#fff;
  border:none;
  padding:6px 0;
  border-radius:4px;
  min-width:110px;
  cursor:pointer;
}

#map {
  height:420px;
  margin-top:30px;
  border-radius:10px;
}

.legend {
  background:#fff;
  padding:8px 12px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  line-height:1.6;
}

.legend span {
  display:inline-block;
  width:14px;
  height:3px;
  margin-right:6px;
}
tr.row-hover:hover { background:#f5faff; cursor:pointer; }

.notice {
  margin-top:12px;
  background:#fff8e1;
  padding:10px;
  border-radius:8px;
  border:1px solid #ffe082;
}
.missing-list { color:#c62828; font-weight:600; }
.popup-flight { margin-bottom:6px; }
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="">
  <h2>‚úàÔ∏è VintageAir ‚Äî —Ä–µ–π—Å—ã –ß—É–∫–æ—Ç–ê–í–ò–ê</h2>
</header>

<!-- ===== –í–ò–¢–†–ò–ù–ê –°–ê–ú–û–õ–Å–¢–û–í ===== -->
<div class="aircraft-showcase">
  <div class="aircraft-card" data-type="AN-24">
    <div class="aircraft-icon">‚úàÔ∏è</div>
    AN-24
  </div>
  <div class="aircraft-card" data-type="DHC-6">
    <div class="aircraft-icon">üõ©</div>
    DHC-6
  </div>
  <div class="aircraft-card" data-type="MI">
    <div class="aircraft-icon">üöÅ</div>
    –ú–∏-8
  </div>
  <div class="aircraft-card active" data-type="">
    <div class="aircraft-icon">üåç</div>
    –í—Å—è —Å–µ—Ç—å
  </div>
</div>

<!-- ===== –§–ò–õ–¨–¢–†–´ ===== -->
<div class="filters">
  <select id="from"><option value="">–û—Ç–∫—É–¥–∞</option></select>
  <select id="to"><option value="">–ö—É–¥–∞</option></select>
  <select id="aircraft"><option value="">–¢–∏–ø –í–°</option></select>
  <input type="date" id="dateFrom">
  <input type="date" id="dateTo">
  <button onclick="resetFilters()">–°–±—Ä–æ—Å</button>
</div>

<div id="missingNotice" class="notice" style="display:none">
  <div>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–¥—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ –∏–∑ CSV –Ω–µ –∏–º–µ—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ:</div>
  <div class="missing-list" id="missingList"></div>
  <div>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ AIRPORTS –≤ index.html –¥–ª—è —ç—Ç–∏—Ö –∫–æ–¥–æ–≤ (—Ñ–æ—Ä–º–∞—Ç: code:[lat,lng]).</div>
</div>

<!-- ===== –¢–ê–ë–õ–ò–¶–ê ===== -->
<table id="table" style="display:none">
<thead>
<tr>
  <th>–î–∞—Ç–∞</th>
  <th>–û—Ç–∫—É–¥–∞</th>
  <th>–ö—É–¥–∞</th>
  <th>–†–µ–π—Å</th>
  <th>–í—ã–ª–µ—Ç</th>
  <th>–ü—Ä–∏–ª—ë—Ç</th>
  <th>–°–∞–º–æ–ª—ë—Ç</th>
  <th>–°–≤–æ–±–æ–¥–Ω–æ</th>
  <th></th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div id="map"></div>

<script>
let flights=[];

/* ===== –ê–≠–†–û–ü–û–†–¢–´ =====
   –î–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∫–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –≤–∞—à–µ–º CSV.
   –ü—Ä–∏–º–µ—Ä:
     BNG: [64.123,170.456],
     –í–ì–ò: [63.987,171.234]
   –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî –º–∞—Ä—à—Ä—É—Ç—ã —Å —ç—Ç–∏–º–∏ –∫–æ–¥–∞–º–∏ –Ω–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è.
*/
const AIRPORTS={
  DYR:[64.734,177.741],
  PVS:[64.378,-173.242],
  KPW:[67.845,166.139],
  PWE:[69.783,170.597],
  KVM:[62.591,174.520],
  "–≠–ì–¢":[66.320,179.122],
  "–ó–õ–ê":[64.817,179.967]
  // –¥–æ–±–∞–≤–∏—Ç—å –ë–ù–ì –∏ –í–ì–ò –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
};

/* ===== –í–° ===== */
function normalizeAircraft(a){
  if(!a) return "OTHER";
  a=a.toString().toUpperCase();
  if(a.includes("AN-24")||a.includes("AN24")||a.includes("ANTONOV")) return "AN-24";
  if(a.includes("DHC-6")||a.includes("DHC6")||a.includes("TWIN OTTER")||a.includes("OTTER")) return "DHC-6";
  if(a.includes("MI")||a.includes("–ú–ò")||a.includes("MI8")||a.includes("MI-8")||a.includes("–ú–ò-8")) return "MI";
  return "OTHER";
}

const COLORS={
  "AN-24":"#d32f2f",
  "DHC-6":"#1976d2",
  "MI":"#388e3c",
  "OTHER":"#555"
};

/* ===== –ö–ê–†–¢–ê –ò –ì–†–£–ü–ü–´ ===== */
let map,geo,markersGroup,interactionGroup;

function initMap(){
  map=L.map("map",{worldCopyJump:false}).setView([65,170],4);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  geo=L.geodesic([], {steps:64}).addTo(map);
  markersGroup = L.layerGroup().addTo(map);
  interactionGroup = L.layerGroup().addTo(map);

  const legend=L.control({position:"bottomright"});
  legend.onAdd=()=>{
    const d=document.createElement("div");
    d.className="legend";
    d.innerHTML=`
      <div><span style="background:${COLORS["AN-24"]}"></span> AN-24</div>
      <div><span style="background:${COLORS["DHC-6"]}"></span> DHC-6</div>
      <div><span style="background:${COLORS["MI"]}"></span> –ú–∏-8</div>`;
    return d;
  };
  legend.addTo(map);
}

/* ===== –£–¢–ò–õ–ò–¢–´ –î–õ–Ø –ü–û–õ–ï–ô CSV (—É—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏) ===== */
function pickField(obj, candidates){
  for(const c of candidates){
    if(obj[c]!==undefined) return obj[c];
    const key = Object.keys(obj).find(k=>k && k.toLowerCase() === c.toLowerCase());
    if(key) return obj[key];
  }
  return "";
}

/* ===== –ó–ê–ì–†–£–ó–ö–ê CSV —Å PapaParse ===== */
fetch("chukotavia_api_results.csv")
.then(r=>r.text())
.then(text=>{
  const res = Papa.parse(text, {header:true, skipEmptyLines:true, dynamicTyping:false});
  const data = res.data || [];
  flights = data.map(row=>{
    const f = {};
    f.date = pickField(row, ["date","Date","–¥–∞—Ç–∞","–î–∞—Ç–∞"]);
    f.origin = pickField(row, ["origin","Origin","from","From","–û—Ç–∫—É–¥–∞","–æ—Ç–∫—É–¥–∞","origin_iata","orig"]);
    f.destination = pickField(row, ["destination","Destination","to","To","–ö—É–¥–∞","–∫—É–¥–∞","dest","destination_iata"]);
    f.flight_number = pickField(row, ["flight_number","flight","Flight","—Ä–µ–π—Å","–†–µ–π—Å","flightNo","flight_no"]);
    f.departure = pickField(row, ["departure","Departure","–≤—ã–ª–µ—Ç","–í—ã–ª–µ—Ç","time_departure","time_dep"]);
    f.arrival = pickField(row, ["arrival","Arrival","–ø—Ä–∏–ª—ë—Ç","–ü—Ä–∏–ª—ë—Ç","arrival_time"]);
    f.aircraft = pickField(row, ["aircraft","Aircraft","—Ç–∏–ø_—Å–∞–º–æ–ª—ë—Ç–∞","type","type_aircraft"]);
    f.price = pickField(row, ["price","Price","—Ü–µ–Ω–∞","–¶–µ–Ω–∞"]) || 0;
    f.available = pickField(row, ["available","Available","places","seats"]) || "";
    f.aircraftType = normalizeAircraft(f.aircraft);
    return f;
  });

  initMap();
  updateFilters();
  render();
})
.catch(err=>{
  console.error("CSV load error:", err);
  alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å chukotavia_api_results.csv ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —Ñ–∞–π–ª –∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –ª–∏ —Ñ–æ—Ä–º–∞—Ç.");
});

/* ===== –§–ò–õ–¨–¢–†–´ ===== */
function norm(d){
  if(!d) return "";
  const p = d.split(".");
  if(p.length!==3) return d;
  return `${p[2]}-${p[1]}-${p[0]}`;
}

function filtered(){
  return flights.filter(f=>{
    const fdate = f.date ? (f.date.includes(".") ? norm(f.date) : f.date) : "";
    return (!from.value || (f.origin && f.origin === from.value)) &&
           (!to.value || (f.destination && f.destination === to.value)) &&
           (!aircraft.value || (f.aircraftType && f.aircraftType === aircraft.value)) &&
           (!dateFrom.value || (fdate && fdate >= dateFrom.value)) &&
           (!dateTo.value || (fdate && fdate <= dateTo.value));
  });
}

function updateFilters(){
  fill(from,filtered().map(f=>f.origin),"–û—Ç–∫—É–¥–∞");
  fill(to,filtered().map(f=>f.destination),"–ö—É–¥–∞");
  fill(aircraft,filtered().map(f=>f.aircraftType),"–¢–∏–ø –í–°");
}

function fill(sel,arr,label){
  const cur=sel.value;
  sel.innerHTML=`<option value="">${label}</option>`;
  [...new Set(arr.filter(Boolean))].sort().forEach(v=>sel.add(new Option(v,v)));
  if([...sel.options].some(o=>o.value===cur)) sel.value=cur;
}

function resetFilters(){
  from.value=to.value=aircraft.value=dateFrom.value=dateTo.value="";
  document.querySelectorAll(".aircraft-card").forEach(c=>c.classList.remove("active"));
  const allCard = document.querySelector('[data-type=""]');
  if(allCard) allCard.classList.add("active");
  updateFilters(); render();
}

/* ===== –¢–ê–ë–õ–ò–¶–ê –ò –ö–ù–û–ü–ö–ò ===== */
const from=document.getElementById("from");
const to=document.getElementById("to");
const aircraft=document.getElementById("aircraft");
const dateFrom=document.getElementById("dateFrom");
const dateTo=document.getElementById("dateTo");
const rows=document.getElementById("rows");
const table=document.getElementById("table");
const missingNotice=document.getElementById("missingNotice");
const missingList=document.getElementById("missingList");

[from,to,aircraft,dateFrom,dateTo].forEach(el=>{
  el.addEventListener('change', ()=>{ updateFilters(); render(); });
});

function render(){
  const res = filtered().sort((a,b)=>{
    const da = a.date ? (a.date.includes(".") ? norm(a.date) : a.date) : "";
    const db = b.date ? (b.date.includes(".") ? norm(b.date) : b.date) : "";
    return da.localeCompare(db);
  });
  rows.innerHTML="";
  table.style.display = res.length ? "table" : "none";

  res.forEach((f, idx)=>{
    rows.innerHTML+=`
    <tr class="row-hover" data-idx="${idx}">
      <td>${f.date||""}</td>
      <td>${f.origin||""}</td>
      <td>${f.destination||""}</td>
      <td>${f.flight_number||""}</td>
      <td>${f.departure||""}</td>
      <td>${f.arrival||""}</td>
      <td>${f.aircraft||""}</td>
      <td>${f.available||""}</td>
      <td><button class="buy">–æ—Ç ${Number(f.price||0).toLocaleString()} ‚ÇΩ</button></td>
    </tr>`;
  });

  // –ü—Ä–∏–≤—è–∑–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Å—Ç—Ä–æ–∫–∞–º (—Ñ–æ–∫—É—Å –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–µ)
  document.querySelectorAll('#rows tr').forEach((tr,i)=>{
    tr.onclick = () => {
      const f = res[i];
      if(f) zoomToRoute(f);
    };
  });

  // –ü—Ä–∏–≤—è–∑–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º "–æ—Ç ..."
  document.querySelectorAll('.buy').forEach((btn,i)=>{
    btn.onclick = (e) => {
      e.stopPropagation();
      const f = res[i];
      if(!f) return;
      openBookingForFlight(f);
    };
  });

  drawRoutes(res);
}

/* ===== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ú–ê–†–®–†–£–¢–û–í –ò –ú–ê–†–ö–ï–†–û–í ===== */
function drawRoutes(list){
  geo.setLatLngs([]);
  markersGroup.clearLayers();
  interactionGroup.clearLayers();

  const usedAirports = new Set();
  const latlngsForBounds = [];
  const missing = new Set();

  // —Å–≥—Ä—É–ø–ø–∏—Ä—É–µ–º —Ä–µ–π—Å—ã –ø–æ –ø–∞—Ä–µ origin-destination (—á—Ç–æ–±—ã –≤ popup –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ–π—Å—ã –º–µ–∂–¥—É –ø–∞—Ä–æ–π)
  const pairs = {}; // key = origin|destination
  list.forEach(f=>{
    if(!f.origin || !f.destination) return;
    const key = `${f.origin}|${f.destination}`;
    pairs[key] = pairs[key] || [];
    pairs[key].push(f);
  });

  Object.keys(pairs).forEach(key=>{
    const [origin,destination] = key.split("|");
    const flightsForPair = pairs[key];

    if(!AIRPORTS[origin] || !AIRPORTS[destination]){
      if(!AIRPORTS[origin]) missing.add(origin);
      if(!AIRPORTS[destination]) missing.add(destination);
      return;
    }

    let [lat1,lng1] = AIRPORTS[origin];
    let [lat2,lng2] = AIRPORTS[destination];

    if(Math.abs(lng1-lng2)>180){
      if(lng1>lng2) lng1-=360; else lng2-=360;
    }

    // –≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–∞—è –¥—É–≥–∞
    geo.addLatLngs([{
      latlngs:[[lat1,lng1],[lat2,lng2]],
      options:{color:COLORS[flightsForPair[0].aircraftType]||COLORS["OTHER"],weight:2,opacity:.85}
    }]);

    // –Ω–µ–≤–∏–¥–∏–º–∞—è —Ç–æ–ª—Å—Ç–∞—è –ª–∏–Ω–∏—è –¥–ª—è –∫–ª–∏–∫–∞ –∏ popup
    const poly = L.polyline([[lat1,lng1],[lat2,lng2]], {weight:12, opacity:0, interactive:true});
    const popupHtml = flightsForPair.map(f=>{
      const dateIso = f.date && f.date.includes('.') ? f.date.split('.').reverse().join('-') : f.date;
      const params = new URLSearchParams({
        origin: f.origin || "",
        destination: f.destination || "",
        date: dateIso || "",
        flight: f.flight_number || "",
        adults: "1"
      });
      const url = "https://booking.chukotavia.com/websky/#/search?" + params.toString();
      return `<div class="popup-flight"><strong>${f.origin} ‚Üí ${f.destination}</strong><br>
        ${f.date || ""} ${f.departure || ""}‚Äì${f.arrival || ""} ‚Ññ${f.flight_number} ‚Äî ${Number(f.price||0).toLocaleString()} ‚ÇΩ (${f.available||""} –º–µ—Å—Ç)
        <br><a href="${url}" target="_blank" rel="noopener">–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</a>
      </div>`;
    }).join("<hr style='border:none;border-top:1px solid #eee;margin:6px 0'>");

    poly.bindPopup(popupHtml);
    interactionGroup.addLayer(poly);

    // –¥–æ–±–∞–≤–∏—Ç—å –≤ bounds
    latlngsForBounds.push([lat1,lng1],[lat2,lng2]);

    // –º–∞—Ä–∫–µ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∏–∂–µ (–ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∫–æ–¥–∞–º)
    usedAirports.add(origin);
    usedAirports.add(destination);
  });

  // –î–æ–±–∞–≤–∏–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤
  usedAirports.forEach(code=>{
    const pos = AIRPORTS[code];
    if(!pos) return;
    const marker = L.circleMarker(pos, {radius:6, color:'#222', fillColor:'#fff', fillOpacity:1, weight:1});
    marker.bindPopup(`<strong>${code}</strong>`);
    markersGroup.addLayer(marker);
  });

  // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–¥–æ–≤, –µ—Å–ª–∏ –µ—Å—Ç—å
  if(missing.size){
    missingNotice.style.display = "";
    missingList.textContent = Array.from(missing).join(", ");
    console.warn("Missing airport coordinates for:", Array.from(missing));
  } else {
    missingNotice.style.display = "none";
    missingList.textContent = "";
  }

  // –ü–æ–¥–æ–≥–Ω–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ–¥ –≤–∏–¥–∏–º—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
  if(latlngsForBounds.length){
    try{
      const bounds = L.latLngBounds(latlngsForBounds);
      map.fitBounds(bounds.pad(0.25));
    }catch(e){
      console.warn("fitBounds failed", e);
    }
  }
}

/* ===== –í–ò–¢–†–ò–ù–ê ===== */
document.querySelectorAll(".aircraft-card").forEach(c=>{
  c.onclick=()=>{
    document.querySelectorAll(".aircraft-card").forEach(x=>x.classList.remove("active"));
    c.classList.add("active");
    aircraft.value = c.dataset.type || "";
    updateFilters(); render();
  };
});

/* ===== –î–û–ü. –£–¢–ò–õ–ò–¢–´ ===== */
function zoomToRoute(f){
  if(!f || !f.origin || !f.destination) return;
  if(!AIRPORTS[f.origin] || !AIRPORTS[f.destination]) {
    alert("–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã: " + (AIRPORTS[f.origin] ? f.destination : f.origin) + ". –î–æ–±–∞–≤—å—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ AIRPORTS –≤ index.html.");
    return;
  }
  let [lat1,lng1]=AIRPORTS[f.origin];
  let [lat2,lng2]=AIRPORTS[f.destination];
  if(Math.abs(lng1-lng2)>180){
    if(lng1>lng2) lng1-=360;
    else lng2-=360;
  }
  const bounds = L.latLngBounds([[lat1,lng1],[lat2,lng2]]);
  map.fitBounds(bounds.pad(0.25));
}

/* ===== –ë–†–û–ù–ò–†–û–í–ê–ù–ò–ï: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ booking.chukotavia.com —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ===== */
function openBookingForFlight(f){
  if(!f) return;
  // –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –∏–∑ dd.mm.yyyy -> yyyy-mm-dd
  const dateIso = f.date && f.date.includes('.') ? f.date.split('.').reverse().join('-') : f.date || "";
  const params = new URLSearchParams({
    origin: f.origin || "",
    destination: f.destination || "",
    date: dateIso,
    flight: f.flight_number || "",
    adults: "1"
  });
  const url = "https://booking.chukotavia.com/websky/#/search?" + params.toString();
  window.open(url, "_blank");
}
</script>

</body>
</html>
